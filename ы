-- Rayfield Interface Setup
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

Rayfield:Notify({
   Title = "Loading Gojo Hub",
   Content = "Thanks For Using Gojo Hub!",
   Duration = 3,
   Image = 4483362458,
})

local Window = Rayfield:CreateWindow({
   Name = "Gojo Hub | MM2",
   LoadingTitle = "Loading Gojo Hub",
   LoadingSubtitle = "by Gojo",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "GojoHubConfig",
      FileName = "MM2Config"
   },
   KeySystem = false,
})

-- Tabs
local InfoTab = Window:CreateTab("‚ùì Info")
local MainTab = Window:CreateTab("üè† Main")
local PlayerTab = Window:CreateTab("üôç‚Äç‚ôÇ Player")
local TeleportTab = Window:CreateTab("‚õ≥ Teleport")
local AutoFarmTab = Window:CreateTab("‚ôª Auto Farm")
local EspTab = Window:CreateTab("üü• ESP")
local RolesTab = Window:CreateTab("üßè Roles")
local SettingsTab = Window:CreateTab("‚öô Settings")

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Player Variables
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:FindFirstChildOfClass("Humanoid")
local RootPart = Humanoid and Humanoid.RootPart or Character:FindFirstChild("HumanoidRootPart")

-- Character Setup
LocalPlayer.CharacterAdded:Connect(function(newChar)
    Character = newChar
    Humanoid = newChar:WaitForChildOfClass("Humanoid")
    RootPart = Humanoid.RootPart or newChar:WaitForChild("HumanoidRootPart")
end)

--[[
    INFO TAB
]]
local ParagraphInfoServer = InfoTab:CreateParagraph({
    Title = "Server Info", 
    Content = "Loading server information..."
})

local function getServerInfo()
    return {
        PlaceId = game.PlaceId,
        JobId = game.JobId,
        Players = #Players:GetPlayers(),
        MaxPlayers = Players.MaxPlayers
    }
end

task.spawn(function()
    while true do
        local info = getServerInfo()
        ParagraphInfoServer:Set({
            Title = "Server Info",
            Content = string.format(
                "Place ID: %d\nJob ID: %s\nPlayers: %d/%d",
                info.PlaceId,
                info.JobId,
                info.Players,
                info.MaxPlayers
            )
        })
        task.wait(5)
    end
end)

InfoTab:CreateButton({
    Name = "Copy Discord",
    Callback = function()
        setclipboard("https://discord.gg/7WtejdcD")
        Rayfield:Notify({
            Title = "Discord Copied",
            Content = "Discord link copied to clipboard!",
            Duration = 3
        })
    end
})

--[[
    ROLES TAB
]]
local rolesLabel = RolesTab:CreateLabel("Sheriff: None\nMurderer: None")

local function UpdateRoles()
    local sheriffName = "None"
    local murdererName = "None"
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character then
            -- Check for Sheriff/Hero
            if player.Character:FindFirstChild("Gun") or 
               (player.Backpack and player.Backpack:FindFirstChild("Gun")) then
                sheriffName = player.Name
            -- Check for Murderer
            elseif player.Character:FindFirstChild("Knife") or 
                  (player.Backpack and player.Backpack:FindFirstChild("Knife")) then
                murdererName = player.Name
            end
        end
    end
    
    rolesLabel:Set(string.format("Sheriff: %s\nMurderer: %s", sheriffName, murdererName))
end

RolesTab:CreateButton({
    Name = "Copy Roles",
    Callback = function()
        local sheriff, murderer = rolesLabel.Text:match("Sheriff: (.-)\nMurderer: (.+)")
        setclipboard(string.format("Sheriff: %s\nMurderer: %s", sheriff, murderer))
        Rayfield:Notify({
            Title = "Roles Copied",
            Content = "Roles copied to clipboard!",
            Duration = 2
        })
    end
})

-- Update roles every second
task.spawn(function()
    while true do
        UpdateRoles()
        task.wait(1)
    end
end)

--[[
    PLAYER TAB - MOVEMENT
]]
local walkSpeed = 16
local jumpPower = 50
local isSpeedActive = false
local isJumpActive = false

-- Walk Speed
PlayerTab:CreateSlider({
    Name = "Walk Speed",
    Range = {16, 100},
    Increment = 1,
    CurrentValue = 16,
    Callback = function(value)
        walkSpeed = value
        if isSpeedActive and Humanoid then
            Humanoid.WalkSpeed = walkSpeed
        end
    end
})

PlayerTab:CreateToggle({
    Name = "Enable Walk Speed",
    CurrentValue = false,
    Callback = function(value)
        isSpeedActive = value
        if Humanoid then
            Humanoid.WalkSpeed = value and walkSpeed or 16
        end
    end
})

-- Jump Power
PlayerTab:CreateSlider({
    Name = "Jump Power",
    Range = {50, 200},
    Increment = 1,
    CurrentValue = 50,
    Callback = function(value)
        jumpPower = value
        if isJumpActive and Humanoid then
            Humanoid.JumpPower = jumpPower
        end
    end
})

PlayerTab:CreateToggle({
    Name = "Enable Jump Power",
    CurrentValue = false,
    Callback = function(value)
        isJumpActive = value
        if Humanoid then
            Humanoid.JumpPower = value and jumpPower or 50
        end
    end
})

-- Infinite Jump
PlayerTab:CreateToggle({
    Name = "Infinite Jump",
    CurrentValue = false,
    Callback = function(value)
        if value then
            UserInputService.JumpRequest:Connect(function()
                if Humanoid then
                    Humanoid:ChangeState("Jumping")
                end
            end)
        end
    end
})

-- Noclip
local noclipActive = false
PlayerTab:CreateToggle({
    Name = "Noclip",
    CurrentValue = false,
    Callback = function(value)
        noclipActive = value
        if Character then
            for _, part in ipairs(Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = not value
                end
            end
        end
    end
})

-- Auto-update noclip
RunService.Stepped:Connect(function()
    if noclipActive and Character then
        for _, part in ipairs(Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

--[[
    ESP TAB
]]
local roleColors = {
    Murderer = Color3.fromRGB(255, 0, 0),
    Sheriff = Color3.fromRGB(0, 0, 255),
    Hero = Color3.fromRGB(255, 255, 0),
    Innocent = Color3.fromRGB(0, 255, 0),
    Default = Color3.fromRGB(200, 200, 200)
}

local function getPlayerRole(player)
    local success, data = pcall(function()
        return ReplicatedStorage:FindFirstChild("GetPlayerData", true):InvokeServer()
    end)
    
    if success and data[player.Name] then
        return data[player.Name].Role or "Default"
    end
    return "Default"
end

EspTab:CreateToggle({
    Name = "Player ESP",
    CurrentValue = false,
    Callback = function(value)
        if value then
            -- Create ESP for existing players
            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character then
                    local head = player.Character:FindFirstChild("Head")
                    if head then
                        -- Highlight
                        local highlight = Instance.new("Highlight")
                        highlight.Name = "RoleHighlight"
                        highlight.FillColor = roleColors[getPlayerRole(player)]
                        highlight.OutlineColor = Color3.new(1, 1, 1)
                        highlight.Parent = player.Character
                        
                        -- Billboard
                        local billboard = Instance.new("BillboardGui")
                        billboard.Name = "RoleESP"
                        billboard.Adornee = head
                        billboard.Size = UDim2.new(0, 100, 0, 40)
                        billboard.StudsOffset = Vector3.new(0, 3, 0)
                        billboard.AlwaysOnTop = true
                        billboard.Parent = head
                        
                        local textLabel = Instance.new("TextLabel")
                        textLabel.Text = player.Name .. "\nRole: " .. getPlayerRole(player)
                        textLabel.Size = UDim2.new(1, 0, 1, 0)
                        textLabel.BackgroundTransparency = 1
                        textLabel.TextColor3 = roleColors[getPlayerRole(player)]
                        textLabel.TextStrokeTransparency = 0
                        textLabel.Parent = billboard
                    end
                end
            end
            
            -- Connect to new players
            Players.PlayerAdded:Connect(function(player)
                player.CharacterAdded:Connect(function(character)
                    if player ~= LocalPlayer then
                        local head = character:WaitForChild("Head")
                        
                        -- Highlight
                        local highlight = Instance.new("Highlight")
                        highlight.Name = "RoleHighlight"
                        highlight.FillColor = roleColors[getPlayerRole(player)]
                        highlight.OutlineColor = Color3.new(1, 1, 1)
                        highlight.Parent = character
                        
                        -- Billboard
                        local billboard = Instance.new("BillboardGui")
                        billboard.Name = "RoleESP"
                        billboard.Adornee = head
                        billboard.Size = UDim2.new(0, 100, 0, 40)
                        billboard.StudsOffset = Vector3.new(0, 3, 0)
                        billboard.AlwaysOnTop = true
                        billboard.Parent = head
                        
                        local textLabel = Instance.new("TextLabel")
                        textLabel.Text = player.Name .. "\nRole: " .. getPlayerRole(player)
                        textLabel.Size = UDim2.new(1, 0, 1, 0)
                        textLabel.BackgroundTransparency = 1
                        textLabel.TextColor3 = roleColors[getPlayerRole(player)]
                        textLabel.TextStrokeTransparency = 0
                        textLabel.Parent = billboard
                    end
                end)
            end)
        else
            -- Remove all ESP
            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character then
                    if player.Character:FindFirstChild("RoleHighlight") then
                        player.Character.RoleHighlight:Destroy()
                    end
                    
                    local head = player.Character:FindFirstChild("Head")
                    if head and head:FindFirstChild("RoleESP") then
                        head.RoleESP:Destroy()
                    end
                end
            end
        end
    end
})

--[[
    MAIN TAB - GUN FUNCTIONS
]]
MainTab:CreateButton({
    Name = "Grab Gun",
    Callback = function()
        local gun = Workspace:FindFirstChild("GunDrop", true)
        if gun and RootPart then
            if firetouchinterest then
                firetouchinterest(RootPart, gun, 0)
                firetouchinterest(RootPart, gun, 1)
            else
                gun.CFrame = RootPart.CFrame
            end
        end
    end
})

MainTab:CreateToggle({
    Name = "Auto Grab Gun",
    CurrentValue = false,
    Callback = function(value)
        while value do
            local gun = Workspace:FindFirstChild("GunDrop", true)
            if gun and RootPart then
                if firetouchinterest then
                    firetouchinterest(RootPart, gun, 0)
                    firetouchinterest(RootPart, gun, 1)
                else
                    gun.CFrame = RootPart.CFrame
                end
            end
            task.wait(0.1)
        end
    end
})

MainTab:CreateButton({
    Name = "Steal Gun",
    Callback = function()
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                -- Check character first
                if player.Character and player.Character:FindFirstChild("Gun") then
                    player.Character.Gun.Parent = LocalPlayer.Backpack
                -- Check backpack if not in character
                elseif player.Backpack and player.Backpack:FindFirstChild("Gun") then
                    player.Backpack.Gun.Parent = LocalPlayer.Backpack
                end
            end
        end
    end
})

--[[
    TELEPORT TAB
]]
TeleportTab:CreateButton({
    Name = "Teleport to Lobby",
    Callback = function()
        local lobby = Workspace:FindFirstChild("Lobby", true)
        if lobby then
            local part = lobby:FindFirstChildWhichIsA("BasePart")
            if part and RootPart then
                RootPart.CFrame = part.CFrame * CFrame.new(0, 3, 0)
            end
        end
    end
})

TeleportTab:CreateButton({
    Name = "Teleport to Map",
    Callback = function()
        local map = Workspace:FindFirstChild("CoinContainer", true)
        if map then
            local part = map:FindFirstChildWhichIsA("BasePart")
            if part and RootPart then
                RootPart.CFrame = part.CFrame * CFrame.new(0, 3, 0)
            end
        end
    end
})

--[[
    SETTINGS TAB
]]
SettingsTab:CreateButton({
    Name = "Unload GUI",
    Callback = function()
        Rayfield:Destroy()
    end
})

local Themes = {
    ["Default"] = "Default",
    ["Amber Glow"] = "AmberGlow",
    ["Amethyst"] = "Amethyst",
    ["Bloom"] = "Bloom",
    ["Dark Blue"] = "DarkBlue",
    ["Green"] = "Green",
    ["Light"] = "Light",
    ["Ocean"] = "Ocean",
    ["Serenity"] = "Serenity"
}

SettingsTab:CreateDropdown({
    Name = "Change Theme",
    Options = {"Default", "Amber Glow", "Amethyst", "Bloom", "Dark Blue", "Green", "Light", "Ocean", "Serenity"},
    CurrentOption = "Default",
    Callback = function(option)
        Window.ModifyTheme(Themes[option[1]])
    end
})

-- Initialization complete
Rayfield:Notify({
    Title = "Gojo Hub Loaded",
    Content = "Enjoy using Gojo Hub for MM2!",
    Duration = 3,
    Image = 4483362458
})
